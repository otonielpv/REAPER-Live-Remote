<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test API REAPER</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #1a1a1a;
      color: #fff;
    }
    .test-section {
      margin: 20px 0;
      padding: 20px;
      background: #2a2a2a;
      border-radius: 8px;
    }
    button {
      padding: 12px 24px;
      margin: 5px;
      font-size: 16px;
      cursor: pointer;
      background: #4a9eff;
      color: white;
      border: none;
      border-radius: 6px;
    }
    button:hover {
      background: #3a7edf;
    }
    #output {
      margin-top: 20px;
      padding: 15px;
      background: #000;
      border: 1px solid #444;
      border-radius: 6px;
      font-family: monospace;
      white-space: pre-wrap;
      max-height: 400px;
      overflow-y: auto;
    }
    .log-entry {
      margin: 5px 0;
      padding: 5px;
      border-left: 3px solid #4a9eff;
    }
    .log-error {
      border-left-color: #ff4a4a;
      color: #ff8888;
    }
    .log-success {
      border-left-color: #4aff4a;
      color: #88ff88;
    }
  </style>
</head>
<body>
  <h1>ğŸ§ª Test API REAPER</h1>
  
  <div class="test-section">
    <h2>Comandos de Transporte</h2>
    <button onclick="testPlay()">â–¶ï¸ PLAY</button>
    <button onclick="testStop()">â¹ï¸ STOP</button>
    <button onclick="testSeek()">â®ï¸ SEEK a 0.0</button>
  </div>
  
  <div class="test-section">
    <h2>Consultas de Datos</h2>
    <button onclick="testGetMarkers()">ğŸ“Œ GET MARKERS</button>
    <button onclick="testGetRegions()">ğŸ“ GET REGIONS</button>
    <button onclick="testGetTracks()">ğŸšï¸ GET TRACKS</button>
    <button onclick="testGetTransport()">ğŸ® GET TRANSPORT</button>
  </div>
  
  <div class="test-section">
    <h2>Tests Avanzados</h2>
    <button onclick="testJumpToRegion()">ğŸ¯ JUMP TO REGION #1</button>
    <button onclick="testSetVolume()">ğŸ”Š SET Track 1 Volume 0.5</button>
  </div>
  
  <div class="test-section">
    <button onclick="clearOutput()" style="background: #666;">ğŸ—‘ï¸ Limpiar Log</button>
  </div>
  
  <div id="output"></div>

  <script type="module">
    import * as api from './js/api.js';
    
    let logCounter = 0;
    
    function log(message, type = 'info') {
      const output = document.getElementById('output');
      const entry = document.createElement('div');
      entry.className = `log-entry log-${type}`;
      const timestamp = new Date().toLocaleTimeString();
      entry.textContent = `[${timestamp}] ${message}`;
      output.appendChild(entry);
      output.scrollTop = output.scrollHeight;
      console.log(`[${type.toUpperCase()}]`, message);
    }
    
    window.clearOutput = function() {
      document.getElementById('output').innerHTML = '';
      logCounter = 0;
      log('Log limpiado', 'info');
    };
    
    // Tests de Transporte
    window.testPlay = async function() {
      log('ğŸ”µ Ejecutando PLAY...', 'info');
      try {
        const result = await api.play();
        log(`âœ… PLAY ejecutado correctamente. Respuesta: ${JSON.stringify(result)}`, 'success');
      } catch (error) {
        log(`âŒ ERROR en PLAY: ${error.message}`, 'error');
        console.error('Stack trace:', error);
      }
    };
    
    window.testStop = async function() {
      log('ğŸ”µ Ejecutando STOP...', 'info');
      try {
        const result = await api.stop();
        log(`âœ… STOP ejecutado correctamente. Respuesta: ${JSON.stringify(result)}`, 'success');
      } catch (error) {
        log(`âŒ ERROR en STOP: ${error.message}`, 'error');
        console.error('Stack trace:', error);
      }
    };
    
    window.testSeek = async function() {
      log('ğŸ”µ Ejecutando SEEK a 0.0...', 'info');
      try {
        const result = await api.seekTo(0.0);
        log(`âœ… SEEK ejecutado correctamente. Respuesta: ${JSON.stringify(result)}`, 'success');
      } catch (error) {
        log(`âŒ ERROR en SEEK: ${error.message}`, 'error');
        console.error('Stack trace:', error);
      }
    };
    
    // Tests de Consultas
    window.testGetMarkers = async function() {
      log('ğŸ”µ Obteniendo MARKERS...', 'info');
      try {
        const markers = await api.getMarkers();
        log(`âœ… Se obtuvieron ${markers.length} marcadores`, 'success');
        markers.forEach((m, i) => {
          log(`  [${i}] id=${m.id}, name="${m.name}", pos=${m.pos}s`, 'info');
        });
      } catch (error) {
        log(`âŒ ERROR en getMarkers: ${error.message}`, 'error');
        console.error('Stack trace:', error);
      }
    };
    
    window.testGetRegions = async function() {
      log('ğŸ”µ Obteniendo REGIONS...', 'info');
      try {
        const regions = await api.getRegions();
        log(`âœ… Se obtuvieron ${regions.length} regiones`, 'success');
        regions.forEach((r, i) => {
          log(`  [${i}] id=${r.id}, name="${r.name}", start=${r.start}s, end=${r.end}s`, 'info');
        });
      } catch (error) {
        log(`âŒ ERROR en getRegions: ${error.message}`, 'error');
        console.error('Stack trace:', error);
      }
    };
    
    window.testGetTracks = async function() {
      log('ğŸ”µ Obteniendo TRACKS...', 'info');
      try {
        const tracks = await api.getTracks();
        log(`âœ… Se obtuvieron ${tracks.length} pistas`, 'success');
        tracks.slice(0, 10).forEach((t, i) => {
          log(`  [${i}] id=${t.id}, name="${t.name}", vol=${t.vol}, mute=${t.mute}`, 'info');
        });
        if (tracks.length > 10) {
          log(`  ... y ${tracks.length - 10} pistas mÃ¡s`, 'info');
        }
      } catch (error) {
        log(`âŒ ERROR en getTracks: ${error.message}`, 'error');
        console.error('Stack trace:', error);
      }
    };
    
    window.testGetTransport = async function() {
      log('ğŸ”µ Obteniendo TRANSPORT...', 'info');
      try {
        const state = await api.getPlayState();
        log(`âœ… Estado de transporte obtenido`, 'success');
        log(`  isPlaying: ${state.isPlaying}`, 'info');
        log(`  pos: ${state.pos}s`, 'info');
        log(`  currentRegionId: ${state.currentRegionId}`, 'info');
      } catch (error) {
        log(`âŒ ERROR en getPlayState: ${error.message}`, 'error');
        console.error('Stack trace:', error);
      }
    };
    
    // Tests Avanzados
    window.testJumpToRegion = async function() {
      log('ğŸ”µ Saltando a REGION #1...', 'info');
      try {
        // Primero obtener regiones
        const regions = await api.getRegions();
        if (regions.length === 0) {
          throw new Error('No hay regiones disponibles');
        }
        
        const regionId = regions[0].id;
        log(`  Usando regiÃ³n id=${regionId}, name="${regions[0].name}"`, 'info');
        
        const result = await api.jumpToRegion(regionId);
        log(`âœ… JUMP ejecutado correctamente. Respuesta: ${JSON.stringify(result)}`, 'success');
      } catch (error) {
        log(`âŒ ERROR en jumpToRegion: ${error.message}`, 'error');
        console.error('Stack trace:', error);
      }
    };
    
    window.testSetVolume = async function() {
      log('ğŸ”µ Ajustando volumen de Track 1 a 0.5...', 'info');
      try {
        const result = await api.setTrackVol(1, 0.5);
        log(`âœ… setTrackVol ejecutado correctamente. Respuesta: ${JSON.stringify(result)}`, 'success');
      } catch (error) {
        log(`âŒ ERROR en setTrackVol: ${error.message}`, 'error');
        console.error('Stack trace:', error);
      }
    };
    
    // Log inicial
    log('ğŸš€ Test API inicializado. Usa los botones para probar cada funciÃ³n.', 'info');
    log(`ğŸ“ URL base: ${window.location.origin}`, 'info');
  </script>
</body>
</html>
